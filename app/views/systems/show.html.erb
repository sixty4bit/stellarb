<turbo-frame id="content_panel">
<%= render 'shared/breadcrumbs', breadcrumbs: @breadcrumbs %>

<div class="max-w-6xl">
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-orange-500 mb-2"><%= @system.name %></h1>
    <div class="text-sm text-gray-400">
      Coordinates: (<%= @system.x %>, <%= @system.y %>, <%= @system.z %>)
      <% if @system.is_cradle? %>
        <span class="text-xs bg-lime-800 text-lime-200 px-2 py-0.5 ml-2 rounded">[STARTING SYSTEM]</span>
      <% end %>
    </div>
  </div>

  <!-- System Properties -->
  <div class="bg-blue-900 border border-blue-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-lime-400 mb-4">System Properties</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
      <div>
        <span class="text-gray-400 block">Star Type</span>
        <span class="text-white"><%= @system.properties&.dig('star_type')&.humanize || 'Unknown' %></span>
      </div>
      <div>
        <span class="text-gray-400 block">Planets</span>
        <span class="text-white"><%= @system.properties&.dig('planet_count') || '?' %></span>
      </div>
      <div>
        <span class="text-gray-400 block">Hazard Level</span>
        <span class="text-<%= (@system.properties&.dig('hazard_level') || 0) > 50 ? 'red' : 'lime' %>-400">
          <%= @system.properties&.dig('hazard_level') || 0 %>%
        </span>
      </div>
      <div>
        <span class="text-gray-400 block">Discovery</span>
        <span class="text-white">
          <% if @system.discovered_by %>
            <%= @system.discovered_by.name %>
          <% else %>
            Unknown
          <% end %>
        </span>
      </div>
    </div>
  </div>

  <!-- Ships in System -->
  <div class="bg-blue-900 border border-blue-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-lime-400 mb-4">Your Ships Here</h2>
    <% if @ships_in_system.any? %>
      <div class="space-y-2">
        <% @ships_in_system.each do |ship| %>
          <%= link_to ship_path(ship),
              class: "block p-3 hover:bg-blue-800 rounded transition-colors",
              data: { turbo_frame: "content_panel" } do %>
            <span class="text-white"><%= ship.name %></span>
            <span class="text-gray-500 text-sm ml-2"><%= ship.hull_size&.humanize %></span>
            <span class="text-xs text-<%= ship.status == 'docked' ? 'lime' : 'orange' %>-400 ml-2">
              [<%= ship.status&.upcase %>]
            </span>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <p class="text-gray-500">No ships in this system.</p>
    <% end %>
  </div>

  <!-- Buildings in System -->
  <div class="bg-blue-900 border border-blue-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-lime-400 mb-4">Buildings</h2>
    <% if @buildings_in_system.any? %>
      <div class="space-y-2">
        <% @buildings_in_system.each do |building| %>
          <%= link_to building_path(building),
              class: "block p-3 hover:bg-blue-800 rounded transition-colors",
              data: { turbo_frame: "content_panel" } do %>
            <span class="text-white"><%= building.name %></span>
            <span class="text-gray-500 text-sm ml-2"><%= building.function&.humanize %></span>
            <span class="text-xs text-<%= building.status == 'active' ? 'lime' : 'orange' %>-400 ml-2">
              [<%= building.status&.upcase %>]
            </span>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <p class="text-gray-500">No buildings in this system.</p>
    <% end %>
  </div>

  <!-- Available Minerals -->
  <% if @system.available_minerals.any? %>
  <div class="bg-blue-900 border border-blue-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-lime-400 mb-4">Mineral Resources</h2>
    <div class="flex flex-wrap gap-2">
      <% @system.available_minerals.each do |mineral| %>
        <span class="px-3 py-1 bg-blue-800 text-white text-sm rounded"><%= mineral.humanize %></span>
      <% end %>
    </div>
  </div>
  <% end %>

  <!-- Build New Structures -->
  <div class="bg-blue-900 border border-blue-700 p-6 mb-6">
    <h2 class="text-lg font-semibold text-lime-400 mb-4">Build New Structures</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <%
        buildable_types = [
          { name: "Mine", function: "extraction", icon: "‚õèÔ∏è", desc: "Extract minerals" },
          { name: "Warehouse", function: "logistics", icon: "üì¶", desc: "Store & trade goods" },
          { name: "Marketplace", function: "civic", icon: "üè™", desc: "Trade hub" },
          { name: "Factory", function: "refining", icon: "üè≠", desc: "Refine materials" }
        ]
      %>
      <% buildable_types.each do |building_type| %>
        <div class="bg-blue-950 border border-blue-800 p-4 text-center">
          <div class="text-2xl mb-2"><%= building_type[:icon] %></div>
          <div class="text-white font-semibold mb-1"><%= building_type[:name] %></div>
          <div class="text-xs text-gray-400 mb-3"><%= building_type[:desc] %></div>
          <%= link_to new_building_path(system_id: @system.id, function: building_type[:function]),
              class: "inline-block px-3 py-1 bg-orange-800 hover:bg-orange-700 border border-orange-600 text-sm transition-colors",
              data: { turbo_frame: "content_panel" } do %>
            Build
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Actions -->
  <div class="flex flex-wrap gap-4">
    <%= link_to systems_path,
        class: "px-4 py-2 bg-blue-800 hover:bg-blue-700 border border-blue-600 transition-colors",
        data: { turbo_frame: "content_panel" } do %>
      ‚Üê Back to Systems
    <% end %>
    
    <%= link_to system_market_index_path(@system),
        class: "px-4 py-2 bg-lime-800 hover:bg-lime-700 border border-lime-600 transition-colors",
        data: { turbo_frame: "content_panel" } do %>
      <span class="text-orange-300">m</span> View Market
    <% end %>
    
    <% if current_user.ships.operational.first&.current_system == @system %>
      <span class="px-4 py-2 bg-gray-800 border border-gray-600 text-gray-500">
        üìç You are here
      </span>
    <% else %>
      <%= link_to navigation_index_path(destination_id: @system.id),
          class: "px-4 py-2 bg-orange-800 hover:bg-orange-700 border border-orange-600 transition-colors",
          data: { turbo_frame: "content_panel" } do %>
        <span class="text-lime-300">n</span> Navigate Here
      <% end %>
    <% end %>
  </div>

  <div class="mt-8 text-sm text-gray-500">
    <p>Keyboard: Esc to go back, n to navigate</p>
  </div>
</div>
</turbo-frame>
