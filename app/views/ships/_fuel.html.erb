<div class="bg-blue-900 border border-blue-700 p-4 mb-4">
  <h2 class="text-lime-400 font-bold mb-2">⛽ Fuel</h2>
  
  <!-- Fuel Bar -->
  <div class="mb-4">
    <div class="flex justify-between text-sm mb-1">
      <span class="text-gray-400">Current Fuel</span>
      <span class="text-white">
        <span class="<%= fuel_color_class(ship) %>">
          <%= ship.fuel.round(1) %>
        </span>
        / <%= ship.fuel_capacity.round(1) %> units
      </span>
    </div>
    <div class="w-full bg-blue-950 rounded-full h-3 border border-blue-700">
      <% fuel_percent = (ship.fuel / ship.fuel_capacity * 100).clamp(0, 100) %>
      <div class="h-full rounded-full transition-all duration-300 <%= fuel_bar_color_class(ship) %>"
           style="width: <%= fuel_percent %>%">
      </div>
    </div>
  </div>

  <% if ship.status == 'docked' %>
    <!-- Refueling Form -->
    <div class="border-t border-blue-700 pt-4">
      <div class="flex justify-between text-sm mb-3">
        <span class="text-gray-400">Fuel Price at <%= ship.current_system&.name || 'Unknown' %>:</span>
        <span class="text-orange-400"><%= ship.current_fuel_price %> cr/unit</span>
      </div>

      <%= form_with url: refuel_ship_path(ship), method: :post, class: "space-y-3" do |f| %>
        <div class="flex items-center gap-4">
          <div class="flex-1">
            <label for="amount" class="text-gray-400 text-sm block mb-1">Amount to Refuel</label>
            <div class="flex gap-2">
              <%= f.number_field :amount, 
                  id: "refuel_amount",
                  value: [ship.fuel_needed_to_fill.round(1), 10].min,
                  min: 0, 
                  max: ship.fuel_needed_to_fill.round(1),
                  step: 0.1,
                  class: "w-24 bg-blue-950 border border-blue-700 rounded px-3 py-2 text-white focus:border-orange-500 focus:outline-none",
                  data: { 
                    action: "input->refuel#updateCost",
                    refuel_target: "amount",
                    price: ship.current_fuel_price 
                  } %>
              <button type="button" 
                      onclick="document.getElementById('refuel_amount').value = '<%= ship.fuel_needed_to_fill.round(1) %>'"
                      class="px-3 py-2 bg-blue-800 hover:bg-blue-700 text-gray-300 text-sm rounded">
                Fill Tank
              </button>
            </div>
          </div>
          
          <div class="text-right">
            <div class="text-gray-400 text-sm">Estimated Cost</div>
            <div class="text-lg">
              <span class="text-orange-400" data-refuel-target="cost">
                <%= number_to_currency(ship.refuel_cost_for([ship.fuel_needed_to_fill, 10].min), unit: '', precision: 0) %>
              </span>
              <span class="text-gray-500 text-sm">cr</span>
            </div>
          </div>
        </div>

        <div class="flex justify-end">
          <%= f.submit "Refuel", 
              class: "px-4 py-2 bg-orange-700 hover:bg-orange-600 text-white rounded cursor-pointer transition-colors" %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="border-t border-blue-700 pt-4">
      <p class="text-gray-500 text-sm">
        <span class="text-yellow-400">⚠️</span> 
        Refueling is only available while docked at a system.
      </p>
    </div>
  <% end %>
</div>
