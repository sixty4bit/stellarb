<%# Onboarding overlay component
    Requires: user (User object)
    Shows step-by-step tutorial overlay for new users
%>
<% config = onboarding_step_config(user.onboarding_step) %>
<% progress = onboarding_progress(user) %>

<div id="onboarding-overlay"
     data-controller="onboarding"
     data-onboarding-step-value="<%= user.onboarding_step %>"
     data-onboarding-highlight-value="<%= config[:highlight] %>"
     class="fixed inset-0 z-50 flex items-center justify-center">
  <!-- Backdrop with spotlight effect -->
  <div class="absolute inset-0 bg-black bg-opacity-80"
       data-onboarding-target="backdrop"
       data-action="click->onboarding#focusOverlay">
  </div>

  <!-- Overlay Content Box -->
  <div class="relative bg-blue-900 border-2 border-orange-500 rounded-lg shadow-2xl max-w-lg w-full mx-4 p-6"
       data-onboarding-target="content">
    <!-- Progress Bar -->
    <div class="absolute top-0 left-0 right-0 h-1 bg-blue-800 rounded-t-lg overflow-hidden">
      <div class="h-full bg-orange-500 transition-all duration-300"
           style="width: <%= onboarding_progress_percentage(user) %>%">
      </div>
    </div>

    <!-- Step Counter -->
    <div class="text-sm text-blue-300 mb-2 mt-2">
      Step <%= progress[:current] %> of <%= progress[:total] %>
    </div>

    <!-- Icon and Title -->
    <div class="flex items-center gap-3 mb-4">
      <span class="text-4xl"><%= config[:icon] %></span>
      <h2 class="text-2xl font-bold text-orange-400"><%= config[:title] %></h2>
    </div>

    <!-- Description -->
    <p class="text-gray-200 mb-6 leading-relaxed">
      <%= config[:description] %>
    </p>

    <!-- Highlighted Element Indicator -->
    <% if config[:highlight] %>
      <div class="flex items-center gap-2 mb-6 text-sm text-lime-400">
        <span class="animate-pulse">â†’</span>
        <span>Look for the highlighted menu item</span>
      </div>
    <% end %>

    <!-- Action Buttons -->
    <div class="flex items-center justify-between">
      <!-- Skip Button -->
      <%= button_to "Skip Tutorial",
            skip_onboarding_path,
            method: :post,
            class: "text-gray-400 hover:text-white text-sm underline",
            data: { turbo_frame: "_top" } %>

      <!-- Continue Button -->
      <%= button_to config[:action_text] || "Continue",
            advance_onboarding_path,
            method: :post,
            class: "bg-orange-500 hover:bg-orange-600 text-black font-bold px-6 py-2 rounded transition-colors",
            data: {
              turbo_frame: "_top",
              onboarding_target: "continueButton"
            } %>
    </div>

    <!-- Keyboard Hint -->
    <div class="text-xs text-gray-500 mt-4 text-center">
      Press <kbd class="px-1 bg-blue-800 rounded">Enter</kbd> to continue or <kbd class="px-1 bg-blue-800 rounded">Esc</kbd> to skip
    </div>
  </div>
</div>
