<%# Onboarding sidebar component
    Requires: user (User object)
    Shows step-by-step tutorial sidebar for new users
    Designed as non-blocking sidebar so users can see and interact with the actual UI
%>
<% config = onboarding_step_config(user.onboarding_step) %>
<% progress = onboarding_progress(user) %>

<%# Hide mobile-only steps on desktop via sm:hidden %>
<div id="onboarding-sidebar"
     data-controller="onboarding"
     data-onboarding-step-value="<%= user.onboarding_step %>"
     data-onboarding-highlight-value="<%= config[:highlight] %>"
     class="fixed bottom-0 left-0 right-0 sm:top-0 sm:right-0 sm:left-auto sm:bottom-auto sm:h-full w-full sm:w-80 z-40 flex flex-col pointer-events-none <%= 'sm:hidden' if config[:mobile_only] %>">
  
  <!-- Sidebar Panel: bottom card on mobile, right sidebar on desktop -->
  <div class="m-2 sm:m-4 bg-blue-900/95 border-2 border-orange-500 rounded-lg shadow-2xl pointer-events-auto flex flex-col max-h-[50vh] sm:max-h-[calc(100vh-2rem)]"
       data-onboarding-target="content">
    
    <!-- Progress Bar -->
    <div class="h-1 bg-blue-800 rounded-t-lg overflow-hidden flex-shrink-0">
      <div class="h-full bg-orange-500 transition-all duration-300"
           style="width: <%= onboarding_progress_percentage(user) %>%">
      </div>
    </div>

    <!-- Scrollable Content -->
    <div class="p-5 overflow-y-auto flex-1">
      <!-- Step Counter -->
      <div class="text-sm text-blue-300 mb-2">
        Step <%= progress[:current] %> of <%= progress[:total] %>
      </div>

      <!-- Icon and Title -->
      <div class="flex items-center gap-3 mb-4">
        <span class="text-3xl"><%= config[:icon] %></span>
        <h2 class="text-xl font-bold text-orange-400"><%= config[:title] %></h2>
      </div>

      <!-- Description -->
      <p class="text-gray-200 mb-4 leading-relaxed text-sm">
        <%= config[:description] %>
      </p>

      <!-- Highlighted Element Indicator -->
      <% if config[:highlight] %>
        <div class="flex items-center gap-2 mb-4 text-sm text-lime-400 bg-lime-900/30 p-2 rounded">
          <span class="animate-pulse text-lg">ðŸ‘†</span>
          <span>Look for the <strong class="text-lime-300">highlighted item</strong> in the menu</span>
        </div>
      <% end %>
    </div>

    <!-- Action Buttons (Fixed at bottom) -->
    <div class="p-5 pt-0 flex-shrink-0 border-t border-blue-800">
      <div class="flex items-center justify-between">
        <!-- Skip Button -->
        <%= button_to "Skip Tutorial",
              skip_onboarding_path,
              method: :post,
              class: "text-gray-400 hover:text-white text-sm underline",
              data: { turbo_frame: "_top" } %>

        <!-- Continue Button -->
        <%= button_to config[:action_text] || "Continue",
              advance_onboarding_path,
              method: :post,
              class: "bg-orange-500 hover:bg-orange-600 text-black font-bold px-4 py-2 rounded transition-colors text-sm",
              data: {
                turbo_frame: "_top",
                onboarding_target: "continueButton"
              } %>
      </div>

      <!-- Keyboard Hint -->
      <div class="text-xs text-gray-500 mt-3 text-center">
        <kbd class="px-1 bg-blue-800 rounded">Enter</kbd> continue Â· <kbd class="px-1 bg-blue-800 rounded">Esc</kbd> skip
      </div>
    </div>
  </div>
</div>
