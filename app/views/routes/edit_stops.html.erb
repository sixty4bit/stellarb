<turbo-frame id="content_panel">
<%= render 'shared/breadcrumbs', breadcrumbs: @breadcrumbs %>

<div class="max-w-4xl">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-bold text-orange-500">Edit Stops</h1>
      <div class="text-sm text-gray-400">Route: <%= @route.name %></div>
    </div>
    <%= link_to route_path(@route), class: "px-4 py-2 bg-lime-800 text-white hover:bg-lime-700 rounded", data: { turbo_frame: "content_panel" } do %>
      Done
    <% end %>
  </div>

  <!-- Stops List -->
  <div id="stops_list" class="space-y-4 mb-6">
    <% @route.stops.each_with_index do |stop, index| %>
      <div class="bg-blue-900 border border-blue-700 p-4" id="stop_<%= index %>">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <span class="text-gray-400 font-bold"><%= index + 1 %>.</span>
            <span class="text-white"><%= stop["system"] %></span>
          </div>
          <%= button_to route_stop_path(@route, index), 
              method: :delete, 
              class: "text-red-400 hover:text-red-300",
              data: { turbo_method: :delete, turbo_confirm: "Remove this stop?" } do %>
            Remove
          <% end %>
        </div>
        
        <!-- Intents -->
        <div class="mt-2 ml-8 space-y-1">
          <% (stop["intents"] || []).each do |intent| %>
            <div class="text-sm">
              <span class="text-<%= intent['type'] == 'buy' || intent['type'] == 'load' ? 'orange' : 'lime' %>-400">
                <%= intent["type"]&.upcase %>
              </span>
              <span class="text-gray-400">
                <%= intent["commodity"] %> Ã— <%= intent["quantity"] %>
                <% if intent["max_price"] %>
                  (max: <%= intent["max_price"] %> cr)
                <% elsif intent["min_price"] %>
                  (min: <%= intent["min_price"] %> cr)
                <% end %>
              </span>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Add Stop Form -->
  <div class="bg-blue-900 border border-blue-700 p-4">
    <h3 class="text-lime-400 font-bold mb-2">Add Stop</h3>
    <%= form_with url: route_stops_path(@route), method: :post, class: "flex gap-4" do |f| %>
      <div class="flex-1">
        <%= f.select :system_id, 
            @available_systems.map { |s| [s.name, s.id] },
            { prompt: "Select system..." },
            class: "w-full bg-blue-800 border border-blue-600 text-white p-2 rounded" %>
        <%= f.hidden_field :system, value: "" %>
      </div>
      <%= f.submit "Add Stop", class: "px-4 py-2 bg-orange-800 text-white hover:bg-orange-700 rounded cursor-pointer" %>
    <% end %>
  </div>
</div>
</turbo-frame>
