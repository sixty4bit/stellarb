<turbo-frame id="content_panel">
<%= render 'shared/breadcrumbs', breadcrumbs: @breadcrumbs %>

<div class="max-w-4xl" 
     data-controller="route-stops-edit" 
     data-route-stops-edit-route-id-value="<%= @route.id %>"
     data-action="keydown->route-stops-edit#keydown">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-bold text-orange-500">Edit Stops</h1>
      <div class="text-sm text-gray-400">Route: <%= @route.name %></div>
    </div>
    <%= link_to route_path(@route), class: "px-4 py-2 bg-lime-800 text-white hover:bg-lime-700 rounded", data: { turbo_frame: "content_panel" } do %>
      Done
    <% end %>
  </div>

  <%= render "routes/stops_list", route: @route %>

  <!-- Add Stop Form -->
  <div class="bg-blue-900 border border-blue-700 p-4">
    <h3 class="text-lime-400 font-bold mb-2">Add Stop</h3>
    <%= form_with url: route_stops_path(@route), method: :post, scope: :stop, class: "flex gap-4" do |f| %>
      <div class="flex-1">
        <%= f.select :system_id, 
            @available_systems.map { |s| [s.name, s.id] },
            { prompt: "Select system..." },
            class: "w-full bg-blue-800 border border-blue-600 text-white p-2 rounded" %>
        <%= f.hidden_field :system, value: "" %>
      </div>
      <%= f.submit "Add Stop", class: "px-4 py-2 bg-orange-800 text-white hover:bg-orange-700 rounded cursor-pointer" %>
    <% end %>
  </div>

  <div class="mt-4 text-sm text-gray-500">
    <p>Add intents (buy/sell actions) to each stop using the forms above.</p>
    <p class="mt-1">Buy/Load intents require max_price. Sell/Unload intents require min_price.</p>
    <p class="mt-2">Keyboard: j/k=navigate, Enter=edit, x=delete, a=add intent, Esc=clear</p>
  </div>
</div>
</turbo-frame>
